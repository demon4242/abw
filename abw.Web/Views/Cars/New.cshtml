@using System.Web.Optimization
@using abw.Helpers
@model abw.ViewModels.CarViewModel
@{
	ViewBag.Title = "Новая машина";
}
@section styles
{
	@Styles.Render("~/car")
}
@section scripts
{
	<script type="text/javascript">
		require(['newCar'], function (newCar) {
			newCar(@Html.Raw(NewtonJson.Serialize(Model)));
		});
	</script>
}
@using (Html.BeginForm("New"))
{
	Html.RenderPartial("Buttons/_Back");
	<h3>Новая машина</h3>
	<hr />

	@Html.HiddenFor(m => m.Id, new { data_bind = "value: id" })

	<div>
		@Html.LabelFor(m => m.Make)
		@Html.TextBoxFor(m => m.Make, new { data_bind = "value: make" })
		@Html.ValidationMessageFor(m => m.Make)
	</div>

	<div id="carModelsLabel">
		@Html.LabelFor(m => m.Models)
		<input type="button" data-bind="click: addModel" class="btn btn-success btn-xs" value="Добавить" />
	</div>

	<!-- ko foreach: { data: models, afterAdd: addToValidationContext } -->
	<div class="car-model">
		@Html.HiddenFor(m => m.Models[0].Id, new { data_bind = "value: id, attr: { name: 'Models[' + $index() + '].Id' }" })
		@Html.TextBoxFor(m => m.Models[0].Name, new { data_bind = "value: name, attr: { name: 'Models[' + $index() + '].Name' }" })
		<input type="button" data-bind="css: { visible: $parent.models().length > 1 }, click: $parent.deleteCarModel" class="btn btn-danger btn-xs" value="Удалить" />
		@Html.ValidationMessageFor(m => m.Models[0].Name, null, new { data_bind = "attr: { 'data-valmsg-for': 'Models[' + $index() + '].Name' }" })
	</div>
	<!-- /ko -->

	<hr />
	<input type="submit" value="Сохранить" class="btn btn-primary" />
	@Html.ValidationSummary(true)
}
